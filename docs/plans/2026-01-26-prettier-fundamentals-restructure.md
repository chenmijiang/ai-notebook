# Prettier 基础概念文档重构设计

## 背景

当前 `prettier-1-fundamentals.md` 第二至四节存在以下问题：

1. 第二节"设计哲学"内容没紧扣主题，2.1-2.3 重复解释同一概念
2. 3.1 介绍内置解析器，4.1 又重复列出语言支持表格
3. 3.2 AST 处理内容定位不清
4. 整体逻辑性不够好

## 重构目标

| 章节            | 定位           | 内容                     |
| --------------- | -------------- | ------------------------ |
| 第二节 设计哲学 | 回答"为什么"   | 四个关键决策的设计意图   |
| 第三节 工作原理 | 回答"怎么做"   | 深入讲技术实现           |
| 第四节 支持范围 | 回答"能做什么" | 语言支持、插件生态、边界 |

## 第二节"设计哲学"新结构

约 400-500 字，简要介绍四个关键设计决策的设计意图。

### 2.1 Opinionated：用约束换自由

- 合并当前 2.1-2.3 的核心观点
- 极少选项 → 减少决策负担 → 停止争论
- 删除冗余内容，精简为 100-150 字

### 2.2 完全重写：抛弃原始格式

- 不做局部修改，解析后完全重新打印
- 好处：输出 100% 一致
- 坏处：无法保留作者意图（如手动对齐）

### 2.3 行宽优先：让代码自动适配

- printWidth 是核心参数
- 短代码保持单行，长代码自动展开
- 开发者无需手动决定何时换行

### 2.4 中间表示：先规划再输出

- 不直接拼字符串，先生成 Doc/IR
- 使"测量是否超宽 → 决定换行"成为可能
- 为换行算法提供技术基础

## 第三节"工作原理"新结构

约 600-700 字，深入讲技术实现细节。

### 3.1 整体流程

- 使用 mermaid 流程图展示：源代码 → Parser → AST → Printer → Doc → 输出
- 表格说明每个阶段的职责

### 3.2 解析阶段

- Parser 的作用：将代码转为 AST
- 说明"根据文件类型选择解析器"（不列完整表格，留给第四节）
- 一个简单示例：代码 → AST 树状结构

### 3.3 完全重写与 AST

- AST 只保留语义，丢弃格式信息
- 示例：三种写法 → 同一个 AST → 同一个输出
- 这就是"完全重写"的技术基础（呼应设计哲学 2.2）

### 3.4 中间表示与换行算法

- Doc/IR 是什么：格式无关的输出描述
- 换行决策过程：测量 → 比较 printWidth → 决定展开或保持
- 示例：短对象单行 vs 长对象多行（呼应设计哲学 2.3、2.4）

## 第四节"支持范围"新结构

约 400-500 字，讲实际使用。

### 4.1 内置支持的语言

- 完整的语言/解析器/扩展名表格（从当前 3.1 移过来）
- 按类别分组：JS 系、样式、标记语言、数据格式

### 4.2 插件扩展

- 社区插件表格（保留当前内容）
- 插件配置示例

### 4.3 Prettier 的边界

- 能做什么 / 不能做什么（保留当前内容）
- 与其他工具配合的示意图

## 主要变更点

1. **第二节**：2.1-2.3 合并为 2.1，新增 2.2-2.4 讲其他设计决策
2. **第三节**：删除解析器表格，增加"完全重写与 AST"小节，强化设计哲学与技术实现的关联
3. **第四节**：接收第三节的解析器表格，按类别重新组织
4. **流程图**：3.1 使用 mermaid 替代 ASCII 图

## 保留内容

- 第一节"概述"不变
- 第五节"总结"根据重构内容适当调整
- 参考资源不变
